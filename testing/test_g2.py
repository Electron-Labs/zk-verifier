import pytest
from field.fq import Fq
from field.fq2 import Fq2
from bn128.g2 import G2


def test_g2_add():
    G2.field_modulus = 21888242871839275222246405745257275088696311157297823662689037894645226208583
    Fq.field_modulus = G2.field_modulus
    G2.non_residue = Fq(21888242871839275222246405745257275088696311157297823662689037894645226208582)
    Fq2.non_residue = G2.non_residue

    x1 = 10857046999023057135944570762232829481370756359578518086990519993285655852781
    y1 = 11559732032986387107991004021392285783925812861821192530917403151452391805634
    x2 = 8495653923123431417604973247489272438418190587263600148770280649306958101930
    y2 = 4082367875863433681332203403145435568316851327593401208105741076214120093531

    p1 = [Fq2([x1, y1]), Fq2([x2, y2])]
    g2 = G2(p1)

    r1 = Fq(33)
    r2 = Fq(44)

    gr1 = g2.mul_scalar(r1).affine()
    gr2 = g2.mul_scalar(r2).affine()

    grsum1 = gr1 + gr2
    r1r2 = r1 + r2

    grsum2 = g2.mul_scalar(r1r2).affine()

    assert(grsum1 == grsum2)